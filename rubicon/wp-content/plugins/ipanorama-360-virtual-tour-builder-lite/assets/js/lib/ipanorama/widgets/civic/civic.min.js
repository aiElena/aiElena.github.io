!function(e,n){(function(K){"use strict";var e={name:"civic",defaultConfig:{audioControl:!0,titleThumbnails:!0,thumbnailsControl:!0,prevSceneControl:!0,nextSceneControl:!0,zoomInControl:!0,zoomOutControl:!0,lookUpControl:!0,lookDownControl:!0,lookLeftControl:!0,lookRightControl:!0,homeControl:!1,fullscreenControl:!0,viewerModeControl:!1,toogleInterfaceControl:!0,startFullscreen:!1,hideInterface:!1},widget:function(e,r,s,n){n&&(s=K.Utils.extend(n,s)),this.audioPlayer=new K.AudioPlayer;var o=this,a=K.$,l=a(e),i=a(r),t=a("<div>").addClass("ipnrm-placeholder").css({display:"none"}),c={},d=null,m=null,u=null,f=!1,p=null,v=null;this.init=function(){o.audioPlayer.init(),h(),g()},this.setAudio=function(e){e.src?(u!==e.src&&(u=e.src,o.audioPlayer.setAudio(e.src),e.loop&&o.audioPlayer.setLoop(e.loop),e.volume&&o.audioPlayer.setVolume(e.volume),e.autoPlay&&o.audioPlayer.play()),c.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(o.audioPlayer.setAudio(),u=null,c.$audioPlayer.removeClass("ipnrm-active"))},this.destroy=function(){$(),c.$widget.remove(),c={},i.removeClass("ipnrm-widget-civic"),o.audioPlayer.destroy()};var h=function(){i.addClass("ipnrm-widget-civic"),c.$widget=a("<div>").addClass("ipnrm-widget"),c.$firstLoad=a("<div>").addClass("ipnrm-first-load"),c.$progress=a("<div>").addClass("ipnrm-progress"),c.$progressBar=a("<div>").addClass("ipnrm-progress-bar").appendTo(c.$progress),c.$interface=a("<div>").addClass("ipnrm-interface"),c.$audioPlayer=o.audioPlayer.controls.$widget,c.$thumbsBar=a("<div>").addClass("ipnrm-thumbs-bar"),c.$menuBar=a("<div>").addClass("ipnrm-menu-bar"),c.$interface.append(c.$thumbsBar,c.$menuBar),c.$prevScene=a("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),c.$nextScene=a("<div>").addClass("ipnrm-btn ipnrm-next-scene"),c.$zoomIn=a("<div>").addClass("ipnrm-btn ipnrm-zoom-in"),c.$zoomOut=a("<div>").addClass("ipnrm-btn ipnrm-zoom-out"),c.$lookUp=a("<div>").addClass("ipnrm-btn ipnrm-look-up"),c.$lookDown=a("<div>").addClass("ipnrm-btn ipnrm-look-down"),c.$lookLeft=a("<div>").addClass("ipnrm-btn ipnrm-look-left"),c.$lookRight=a("<div>").addClass("ipnrm-btn ipnrm-look-right"),c.$home=a("<div>").addClass("ipnrm-btn ipnrm-home"),c.$fullscreen=a("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),c.$vr=a("<div>").addClass("ipnrm-btn ipnrm-vr"),c.$toggleInterface=a("<div>").addClass("ipnrm-btn ipnrm-toggle-interface"),c.$menuBar.append(c.$prevScene,c.$nextScene,c.$zoomIn,c.$zoomOut,c.$lookUp,c.$lookDown,c.$lookLeft,c.$lookRight,c.$home,c.$fullscreen,c.$vr,c.$toggleInterface),c.$widget.append(c.$progress,c.$firstLoad,c.$audioPlayer,c.$interface),i.append(c.$widget),s.startFullscreen&&i.addClass("ipnrm-fullscreen"),s.hideInterface&&c.$interface.addClass("ipnrm-hide-controls"),C(),l.on("ipanorama:config",B).trigger("ipanorama:config")},g=function(){i.on("ipanorama:ready",T),i.on("mouseup touchend",D),i.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",J),l.on("ipanorama:scene-before-load",L),l.on("ipanorama:scene-after-load",F),l.on("ipanorama:scene-progress",I),l.on("ipanorama:scene-error",S),l.on("ipanorama:scene-show-start",P),l.on("ipanorama:mode",R),c.$thumbsBar.on("click",".ipnrm-thumb",x),c.$firstLoad.on("click",U),c.$prevScene.on("click",O),c.$nextScene.on("click",q),c.$zoomIn.on("mousedown touchstart",E),c.$zoomOut.on("mousedown touchstart",W),c.$lookUp.on("mousedown touchstart",M),c.$lookDown.on("mousedown touchstart",Z),c.$lookLeft.on("mousedown touchstart",N),c.$lookRight.on("mousedown touchstart",_),c.$home.on("click",V),c.$fullscreen.on("click",j),c.$vr.on("click",G),c.$toggleInterface.on("click",H)},$=function(){i.off("ipanorama:ready",T),i.off("mouseup  touchend",D),i.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",J),l.off("ipanorama:scene-before-load",L),l.off("ipanorama:scene-after-load",F),l.off("ipanorama:scene-progress",I),l.off("ipanorama:scene-error",S),l.off("ipanorama:scene-show-start",P),l.off("ipanorama:mode",R),c.$thumbsBar.off("click",".ipnrm-thumb",x),c.$firstLoad.off("click",U),c.$prevScene.off("click",O),c.$nextScene.off("click",q),c.$zoomIn.off("mousedown touchstart",E),c.$zoomOut.off("mousedown touchstart",W),c.$lookUp.off("mousedown touchstart",M),c.$lookDown.off("mousedown touchstart",Z),c.$lookLeft.off("mousedown touchstart",N),c.$lookRight.off("mousedown touchstart",_),c.$home.off("click",V),c.$fullscreen.off("click",j),c.$vr.off("click",G),c.$toggleInterface.off("click",H)},C=function(){c.$firstLoad.addClass("ipnrm-hide"),c.$audioPlayer.addClass("ipnrm-hide"),c.$thumbsBar.addClass("ipnrm-hide"),c.$prevScene.addClass("ipnrm-hide"),c.$nextScene.addClass("ipnrm-hide"),c.$zoomIn.addClass("ipnrm-hide"),c.$zoomOut.addClass("ipnrm-hide"),c.$lookUp.addClass("ipnrm-hide"),c.$lookDown.addClass("ipnrm-hide"),c.$lookLeft.addClass("ipnrm-hide"),c.$lookRight.addClass("ipnrm-hide"),c.$home.addClass("ipnrm-hide"),c.$fullscreen.addClass("ipnrm-hide"),c.$vr.addClass("ipnrm-hide"),c.$toggleInterface.addClass("ipnrm-hide")},w=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control,n=e.getZoom();"flat"==v.viewer.sceneActive.cfg.type?n+=.01:"littleplanet"==v.viewer.sceneActive.cfg.type?n-=50:n-=.2,e.setZoom(n),w()},10)},b=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control,n=e.getZoom();"flat"==v.viewer.sceneActive.cfg.type?n-=.01:"littleplanet"==v.viewer.sceneActive.cfg.type?n+=50:n+=.2,e.setZoom(n),b()},10)},k=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control;"flat"==v.viewer.sceneActive.cfg.type?e.rotateUp(5):e.rotateUp(.01),k()},10)},y=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control;"flat"==v.viewer.sceneActive.cfg.type?e.rotateUp(-5):e.rotateUp(-.01),y()},10)},A=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control;"flat"==v.viewer.sceneActive.cfg.type?e.rotateLeft(5):e.rotateLeft(.01),A()},10)},z=function(){p=setTimeout(function(){var e=v.viewer.sceneActive.control;"flat"==v.viewer.sceneActive.cfg.type?e.rotateLeft(-5):e.rotateLeft(-.01),z()},10)},I=function(e,n){n.progress.loaded<n.progress.total?(f||(c.$progress.addClass("ipnrm-active"),f=!0),c.$progressBar.css({width:n.progress.loaded/n.progress.total*100+"%"})):(f&&(c.$progress.removeClass("ipnrm-active"),f=!1),c.$progressBar.css({width:0}))},L=function(e,n){},F=function(e,n){c.$progress.removeClass("ipnrm-active"),f=!1;var o=c.$thumbsBar.find('.ipnrm-thumb[data-scene-id="'+n.scene.cfg.id+'"]');c.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),o.addClass("ipnrm-active"),function(){c.$firstLoad.addClass("ipnrm-hide"),s.audioControl&&c.$audioPlayer.removeClass("ipnrm-hide"),s.thumbnailsControl&&c.$thumbsBar.removeClass("ipnrm-hide"),s.prevSceneControl&&c.$prevScene.removeClass("ipnrm-hide"),s.nextSceneControl&&c.$nextScene.removeClass("ipnrm-hide"),s.zoomInControl&&c.$zoomIn.removeClass("ipnrm-hide"),s.zoomOutControl&&c.$zoomOut.removeClass("ipnrm-hide"),s.lookUpControl&&c.$lookUp.removeClass("ipnrm-hide"),s.lookDownControl&&c.$lookDown.removeClass("ipnrm-hide"),s.lookLeftControl&&c.$lookLeft.removeClass("ipnrm-hide"),s.lookRightControl&&c.$lookRight.removeClass("ipnrm-hide"),s.homeControl&&c.$home.removeClass("ipnrm-hide"),s.fullscreenControl&&c.$fullscreen.removeClass("ipnrm-hide"),s.viewerModeControl&&c.$vr.removeClass("ipnrm-hide"),s.toogleInterfaceControl&&c.$toggleInterface.removeClass("ipnrm-hide"),i.hasClass("ipnrm-fullscreen")?c.$fullscreen.addClass("ipnrm-active"):c.$fullscreen.removeClass("ipnrm-active");c.$widget.hasClass("ipnrm-hide-controls")?c.$toggleInterface.removeClass("ipnrm-active"):c.$toggleInterface.addClass("ipnrm-active")}(),setTimeout(function(){if(c.$thumbs.find(".ipnrm-thumb").length){var e=c.$thumbs.find(".ipnrm-thumb:first-child").get(0).offsetLeft;c.$thumbsBar.get(0).scrollLeft=o.get(0).offsetLeft-e}},100)},S=function(e,n){c.$progress.removeClass("ipnrm-active"),f=!1,C()},P=function(e,n){o.setAudio(n.scene.cfg.audio)},T=function(e,n){v=n.instance},B=function(e,n){if(n&&n.config){if(l.off("ipanorama:config",B),!n.config.autoLoad&&0<n.config.scenes.length){c.$firstLoad.removeClass("ipnrm-hide");var o=n.config.scenes[0],i=a(r).data("scene-id");if(i)for(var t=0;t<n.config.scenes.length;t++)if(n.config.scenes[t].id===i){o=n.config.scenes[t];break}m=o.id}!function(e){if(!e.scenes.length)return;c.$thumbs=a("<div>").addClass("ipnrm-thumbs"),c.$thumbsBar.append(c.$thumbs);for(var n=0;n<e.scenes.length;n++){var o=e.scenes[n],i=a("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":o.id});if(s.titleThumbnails){if(o.title){var t=a("<div>").addClass("ipnrm-thumb-title").html(o.title);c.$thumbs.append(i.append(t))}}else if(o.image||o.imageThumb){var r=a("<img>").attr({src:o.imageThumb?o.imageThumb:o.image});c.$thumbs.append(i.append(r))}}}(n.config)}},R=function(e,n){if(n&&n.master)switch(d=n.mode){case"normal":c.$vr.removeClass("ipnrm-active");break;case"stereo":c.$vr.addClass("ipnrm-active")}},x=function(e){l.trigger("ipanorama:set-scene",{id:a(this).data("scene-id")}),c.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),a(this).addClass("ipnrm-active")},U=function(e){m&&(c.$firstLoad.addClass("ipnrm-hide"),l.trigger("ipanorama:set-scene",{id:m}))},O=function(e){if(v.viewer&&v.viewer.sceneActive){for(var n=v.viewer.sceneActive.cfg.id,o=0;o<v.config.scenes.length;o++){var i=v.config.scenes[o];if(i.id==n)break}o-1<0?o=v.config.scenes.length-1:o-=1,l.trigger("ipanorama:set-scene",{id:v.config.scenes[o].id})}},q=function(e){if(v.viewer&&v.viewer.sceneActive){for(var n=v.viewer.sceneActive.cfg.id,o=0;o<v.config.scenes.length;o++){var i=v.config.scenes[o];if(i.id==n)break}o+1>=v.config.scenes.length?o=0:o+=1,l.trigger("ipanorama:set-scene",{id:v.config.scenes[o].id})}},D=function(e){clearTimeout(p)},E=function(e){clearTimeout(p),w()},W=function(e){clearTimeout(p),b()},M=function(e){clearTimeout(p),k()},Z=function(e){clearTimeout(p),y()},N=function(e){clearTimeout(p),A()},_=function(e){clearTimeout(p),z()},V=function(e){var n=v.viewer.sceneActive.control;n.setAlphaBetaPos(v.viewer.sceneActive.cfg.camera.pos.alpha,v.viewer.sceneActive.cfg.camera.pos.beta)},j=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(c.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=i.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else i.toggleClass("ipnrm-fullscreen-mode"),i.hasClass("ipnrm-fullscreen-mode")?(c.$fullscreen.addClass("ipnrm-active"),t.insertBefore(i),i.detach(),a("body").append(i)):(c.$fullscreen.removeClass("ipnrm-active"),i.detach(),i.insertAfter(t),t.remove()),v._onWindowResize()},G=function(e){var n=d;switch(n){case"normal":n="stereo";break;case"stereo":n="normal"}l.trigger("ipanorama:mode",{mode:n})},H=function(e){c.$widget.toggleClass("ipnrm-hide-controls"),c.$widget.hasClass("ipnrm-hide-controls")?c.$toggleInterface.removeClass("ipnrm-active"):c.$toggleInterface.addClass("ipnrm-active")},J=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?c.$fullscreen.addClass("ipnrm-active"):c.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){v._onWindowResize()},100)}}};K.Widget=K.Widget||{},K.Widget.Civic=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);