!function(e,n){(function(U){"use strict";var e={name:"modern",defaultConfig:{titleControl:!0,audioControl:!0,prevSceneControl:!0,nextSceneControl:!0,fullscreenControl:!0,thumbnailControl:!1,viewerModeControl:!1,moveToNextScene:!0},widget:function(e,i,r,n){n&&(r=U.Utils.extend(n,r)),this.audioPlayer=new U.AudioPlayer;var s=this,t=U.$,o=t(e),a=t(i),l=t("<div>").addClass("ipnrm-placeholder").css({display:"none"}),c={},d=null,m=null,p=null,u=[],f=null,$=null,v=!1,h=null;this.init=function(){s.audioPlayer.init(),C(),g()},this.setAudio=function(e){e.src?($!==e.src&&($=e.src,s.audioPlayer.setAudio(e.src),e.loop&&s.audioPlayer.setLoop(e.loop),e.volume&&s.audioPlayer.setVolume(e.volume),e.autoPlay&&s.audioPlayer.play()),c.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(s.audioPlayer.setAudio(),$=null,c.$audioPlayer.removeClass("ipnrm-active"))},this.destroy=function(){b(),c.$widget.remove(),c={},a.removeClass("ipnrm-widget-modern"),s.audioPlayer.destroy()};var C=function(){a.addClass("ipnrm-widget-modern"),c.$widget=t("<div>").addClass("ipnrm-widget"),c.$firstLoad=t("<div>").addClass("ipnrm-first-load"),c.$ts=t("<div>").addClass("ipnrm-ts"),c.$bs=t("<div>").addClass("ipnrm-bs"),c.$tlBar=t("<div>").addClass("ipnrm-tl-bar"),c.$trBar=t("<div>").addClass("ipnrm-tr-bar"),c.$brBar=t("<div>").addClass("ipnrm-br-bar"),c.$blBar=t("<div>").addClass("ipnrm-bl-bar"),c.$progress=t("<div>").addClass("ipnrm-progress"),c.$progressBar=t("<div>").addClass("ipnrm-progress-bar").appendTo(c.$progress),c.$audioPlayer=s.audioPlayer.controls.$widget,c.$prevScene=t("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),c.$nextScene=t("<div>").addClass("ipnrm-btn ipnrm-next-scene"),c.$vr=t("<div>").addClass("ipnrm-btn ipnrm-vr"),c.$thumbs=t("<div>").addClass("ipnrm-btn ipnrm-thumbs"),c.$fullscreen=t("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),c.$title=t("<div>").addClass("ipnrm-title"),c.$ts.append(c.$tlBar,c.$trBar),c.$bs.append(c.$blBar,c.$brBar),c.$tlBar.append(c.$audioPlayer),c.$trBar.append(c.$prevScene,c.$nextScene),c.$brBar.append(c.$vr,c.$thumbs,c.$fullscreen),c.$blBar.append(c.$title),c.$thumbsWrap=t("<div>").addClass("ipnrm-thumbs-wrap"),c.$thumbsList=t("<div>").addClass("ipnrm-thumbs-list"),c.$thumbsClose=t("<div>").addClass("ipnrm-thumbs-close"),c.$thumbsWrap.append(c.$thumbsList,c.$thumbsClose),c.$widget.append(c.$progress,c.$firstLoad,c.$ts,c.$bs,c.$thumbsWrap),a.append(c.$widget),w(),o.on("ipanorama:config",W).trigger("ipanorama:config")},g=function(){a.on("ipanorama:ready",O),a.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",_),o.on("ipanorama:scene-before-load",z),o.on("ipanorama:scene-after-load",q),o.on("ipanorama:scene-progress",R),o.on("ipanorama:scene-error",T),o.on("ipanorama:scene-hide-start",E),o.on("ipanorama:scene-hide-complete",M),o.on("ipanorama:scene-show-start",N),o.on("ipanorama:scene-show-complete",I),o.on("ipanorama:scene-index",H),o.on("ipanorama:mode",A),c.$prevScene.on("click",S),c.$nextScene.on("click",k),c.$vr.on("click",y),c.$fullscreen.on("click",L),c.$thumbs.on("click",x),c.$thumbsList.on("click",".ipnrm-thumb",F),c.$thumbsClose.on("click",P),c.$firstLoad.on("click",B)},b=function(){a.off("ipanorama:ready",O),a.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",_),o.off("ipanorama:scene-before-load",z),o.off("ipanorama:scene-after-load",q),o.off("ipanorama:scene-progress",R),o.off("ipanorama:scene-error",T),o.off("ipanorama:scene-hide-start",E),o.off("ipanorama:scene-hide-complete",M),o.off("ipanorama:scene-show-start",N),o.off("ipanorama:scene-show-complete",I),o.off("ipanorama:scene-index",H),o.off("ipanorama:mode",A),c.$prevScene.off("click",S),c.$nextScene.off("click",k),c.$vr.off("click",y),c.$fullscreen.off("click",L),c.$thumbs.off("click",x),c.$thumbsList.off("click",".ipnrm-thumb",F),c.$thumbsClose.off("click",P),c.$firstLoad.off("click",B)},w=function(){c.$firstLoad.addClass("ipnrm-hide"),c.$title.addClass("ipnrm-hide"),c.$audioPlayer.addClass("ipnrm-hide"),c.$prevScene.addClass("ipnrm-hide"),c.$nextScene.addClass("ipnrm-hide"),c.$fullscreen.addClass("ipnrm-hide"),c.$thumbs.addClass("ipnrm-hide"),c.$vr.addClass("ipnrm-hide"),c.$thumbsWrap.addClass("ipnrm-hide")},S=function(e){(f-=1)<0?f=null:o.trigger("ipanorama:set-scene",{id:u[f]})},k=function(e){(f+=1)>=u.length?(f=u.length-1,o.trigger("ipanorama:next-scene")):o.trigger("ipanorama:set-scene",{id:u[f]})},y=function(e){var n=d;switch(n){case"normal":n="stereo";break;case"stereo":n="normal"}o.trigger("ipanorama:mode",{mode:n})},x=function(e){var n=c.$thumbsList.find(".ipnrm-thumb.ipnrm-active");n.removeClass("ipnrm-active"),(n=c.$thumbsList.find('[data-scene-id="'+m+'"]')).addClass("ipnrm-active"),c.$thumbsWrap.addClass("ipnrm-active")},F=function(e){o.trigger("ipanorama:set-scene",{id:t(this).data("scene-id")}),c.$thumbsWrap.removeClass("ipnrm-active")},P=function(e){c.$thumbsWrap.removeClass("ipnrm-active")},L=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(c.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=a.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else a.toggleClass("ipnrm-fullscreen-mode"),a.hasClass("ipnrm-fullscreen-mode")?(c.$fullscreen.addClass("ipnrm-active"),l.insertBefore(a),a.detach(),t("body").append(a)):(c.$fullscreen.removeClass("ipnrm-active"),a.detach(),a.insertAfter(l),l.remove()),h._onWindowResize()},B=function(e){p&&(c.$firstLoad.addClass("ipnrm-hide"),o.trigger("ipanorama:set-scene",{id:p}))},W=function(e,n){if(n&&n.config){if(o.off("ipanorama:config",W),!n.config.autoLoad&&0<n.config.scenes.length){c.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],a=t(i).data("scene-id");if(a)for(var r=0;r<n.config.scenes.length;r++)if(n.config.scenes[r].id===a){s=n.config.scenes[r];break}p=s.id}!function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.imageThumb){var a=t("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":s.id}),r=t("<img>").attr({src:s.imageThumb});c.$thumbsList.append(a.append(r))}}}(n.config)}},A=function(e,n){if(n&&n.master)switch(d=n.mode){case"normal":c.$vr.removeClass("ipnrm-active");break;case"stereo":c.$vr.addClass("ipnrm-active")}},R=function(e,n){n.progress.loaded<n.progress.total?(v||(c.$progress.addClass("ipnrm-active"),v=!0),c.$progressBar.css({width:n.progress.loaded/n.progress.total*100+"%"})):(v&&(c.$progress.removeClass("ipnrm-active"),v=!1),c.$progressBar.css({width:0}))},z=function(e,n){},q=function(e,n){c.$progress.removeClass("ipnrm-active"),v=!1,c.$firstLoad.addClass("ipnrm-hide"),r.titleControl&&c.$title.removeClass("ipnrm-hide"),r.audioControl&&c.$audioPlayer.removeClass("ipnrm-hide"),r.prevSceneControl&&c.$prevScene.removeClass("ipnrm-hide"),r.nextSceneControl&&c.$nextScene.removeClass("ipnrm-hide"),r.fullscreenControl&&c.$fullscreen.removeClass("ipnrm-hide"),r.thumbnailControl&&c.$thumbs.removeClass("ipnrm-hide"),r.viewerModeControl&&c.$vr.removeClass("ipnrm-hide"),c.$thumbsWrap.removeClass("ipnrm-hide")},T=function(e,n){c.$progress.removeClass("ipnrm-active"),v=!1,w()},E=function(e,n){},M=function(e,n){},N=function(e,n){s.setAudio(n.scene.cfg.audio),n.scene.cfg.title?(c.$title.get(0).innerHTML=n.scene.cfg.title,c.$title.addClass("ipnrm-active")):(c.$title.get(0).innerHTML=null,c.$title.removeClass("ipnrm-active"))},I=function(e,n){},H=function(e,n){if(n)if(m=n.scene.cfg.id,null==f?(u.push(m),f=0):u[f]!=m&&(f+=1,(u=u.slice(0,f)).push(m)),0<f?c.$prevScene.addClass("ipnrm-active"):c.$prevScene.removeClass("ipnrm-active"),f<u.length-1)c.$nextScene.addClass("ipnrm-active");else if(c.$nextScene.removeClass("ipnrm-active"),r.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var a=n.config.scenes[s];if(a.id==m)break}s<n.config.scenes.length-1&&c.$nextScene.addClass("ipnrm-active")}},O=function(e,n){h=n.instance},_=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?c.$fullscreen.addClass("ipnrm-active"):c.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){h._onWindowResize()},100)}}};U.Widget=U.Widget||{},U.Widget.Modern=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);