!function(e,n){(function(N){"use strict";var e={name:"list",defaultConfig:{prevSceneControl:!0,nextSceneControl:!0,sceneListControl:!0,audioControl:!0,titleControl:!0,fullscreenControl:!0,moveToNextScene:!0},widget:function(e,t,a,n){n&&(a=N.Utils.extend(n,a)),this.audioPlayer=new N.AudioPlayer;var i=this,r=N.$,l=r(e),s=r(t),c=r("<div>").addClass("ipnrm-placeholder").css({display:"none"}),o={},d=null,m=null,f=[],p=null,u=null,v=!1,$=null;this.init=function(){i.audioPlayer.init(),g(),C()},this.setAudio=function(e){e.src?(u!==e.src&&(u=e.src,i.audioPlayer.setAudio(e.src),e.loop&&i.audioPlayer.setLoop(e.loop),e.volume&&i.audioPlayer.setVolume(e.volume),e.autoPlay&&i.audioPlayer.play()),o.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(i.audioPlayer.setAudio(),u=null,o.$audioPlayer.removeClass("ipnrm-active"))},this.destroy=function(){h(),o.$widget.remove(),o={},s.removeClass("ipnrm-widget-list"),i.audioPlayer.destroy()};var g=function(){s.addClass("ipnrm-widget-list"),o.$widget=r("<div>").addClass("ipnrm-widget"),o.$firstLoad=r("<div>").addClass("ipnrm-first-load"),o.$progress=r("<div>").addClass("ipnrm-progress"),o.$navigation=r("<div>").addClass("ipnrm-navigation"),o.$prevScene=r("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),o.$nextScene=r("<div>").addClass("ipnrm-btn ipnrm-next-scene"),o.$sceneListHead=r("<div>").addClass("ipnrm-scene-list-head"),o.$sceneListData=r("<div>").addClass("ipnrm-scene-list-data"),o.$sceneList=r("<div>").addClass("ipnrm-btn ipnrm-scene-list").append("<div><div></div><div></div><div></div></div>"),o.$audioPlayer=i.audioPlayer.controls.$widget,o.$title=r("<div>").addClass("ipnrm-title"),o.$fullscreen=r("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),o.$navigation.append(o.$prevScene,o.$nextScene),o.$widget.append(o.$progress,o.$firstLoad,o.$navigation,o.$sceneListHead,o.$sceneListData,o.$sceneList,o.$audioPlayer,o.$title,o.$fullscreen),s.append(o.$widget),L(),l.on("ipanorama:config",P).trigger("ipanorama:config")},C=function(){s.on("ipanorama:ready",W),s.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",M),l.on("ipanorama:scene-before-load",A),l.on("ipanorama:scene-after-load",D),l.on("ipanorama:scene-progress",b),l.on("ipanorama:scene-error",R),l.on("ipanorama:scene-hide-start",z),l.on("ipanorama:scene-hide-complete",H),l.on("ipanorama:scene-show-start",q),l.on("ipanorama:scene-show-complete",E),l.on("ipanorama:scene-index",T),o.$firstLoad.on("click",F),o.$prevScene.on("click",S),o.$nextScene.on("click",y),o.$sceneList.on("click",w),o.$sceneListData.on("click",".ipnrm-scene-list-item",x),o.$fullscreen.on("click",k)},h=function(){s.off("ipanorama:ready",W),s.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",M),l.off("ipanorama:scene-before-load",A),l.off("ipanorama:scene-after-load",D),l.off("ipanorama:scene-progress",b),l.off("ipanorama:scene-error",R),l.off("ipanorama:scene-hide-start",z),l.off("ipanorama:scene-hide-complete",H),l.off("ipanorama:scene-show-start",q),l.off("ipanorama:scene-show-complete",E),l.off("ipanorama:scene-index",T),o.$firstLoad.off("click",F),o.$prevScene.off("click",S),o.$nextScene.off("click",y),o.$sceneList.off("click",w),o.$sceneListData.off("click",x),o.$fullscreen.off("click",k)},L=function(){o.$firstLoad.addClass("ipnrm-hide"),o.$prevScene.addClass("ipnrm-hide"),o.$nextScene.addClass("ipnrm-hide"),o.$sceneList.addClass("ipnrm-hide"),o.$sceneListHead.addClass("ipnrm-hide"),o.$sceneListData.addClass("ipnrm-hide"),o.$audioPlayer.addClass("ipnrm-hide"),o.$title.addClass("ipnrm-hide"),o.$fullscreen.addClass("ipnrm-hide")},S=function(e){(p-=1)<0?p=null:l.trigger("ipanorama:set-scene",{id:f[p]})},y=function(e){(p+=1)>=f.length?(p=f.length-1,l.trigger("ipanorama:next-scene")):l.trigger("ipanorama:set-scene",{id:f[p]})},w=function(e){o.$sceneList.hasClass("ipnrm-active")?(o.$sceneListHead.css({transition:"all .2s linear .2s"}),o.$sceneListData.css({transition:"all .2s linear"})):(o.$sceneListHead.css({transition:"all .2s linear"}),o.$sceneListData.css({transition:"all .2s linear .2s"})),o.$sceneList.toggleClass("ipnrm-active"),o.$sceneListHead.toggleClass("ipnrm-active"),o.$sceneListData.toggleClass("ipnrm-active")},x=function(e){var n=r(this);d=n.data("scene-id"),l.trigger("ipanorama:set-scene",{id:d})},k=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(o.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=s.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else s.toggleClass("ipnrm-fullscreen-mode"),s.hasClass("ipnrm-fullscreen-mode")?(o.$fullscreen.addClass("ipnrm-active"),c.insertBefore(s),s.detach(),r("body").append(s)):(o.$fullscreen.removeClass("ipnrm-active"),s.detach(),s.insertAfter(c),c.remove()),$._onWindowResize()},F=function(e){m&&(o.$firstLoad.addClass("ipnrm-hide"),l.trigger("ipanorama:set-scene",{id:m}))},P=function(e,n){if(n&&n.config){if(l.off("ipanorama:config",P),!n.config.autoLoad&&0<n.config.scenes.length){o.$firstLoad.removeClass("ipnrm-hide");var i=n.config.scenes[0],s=r(t).data("scene-id");if(s)for(var a=0;a<n.config.scenes.length;a++)if(n.config.scenes[a].id===s){i=n.config.scenes[a];break}m=i.id}!function(e){for(var n=0;n<e.scenes.length;n++){var i=e.scenes[n];if(i.title){var s=r("<div>").addClass("ipnrm-scene-list-item").attr({"data-scene-id":i.id}).html(i.title);o.$sceneListData.append(s)}}}(n.config)}},b=function(e,n){n.progress.loaded<n.progress.total?v||(o.$progress.addClass("ipnrm-active"),v=!0):v&&(o.$progress.removeClass("ipnrm-active"),v=!1)},A=function(e,n){},D=function(e,n){o.$progress.removeClass("ipnrm-active"),v=!1;var i=n.scene.cfg.id;o.$sceneListData.find(".ipnrm-scene-list-item").removeClass("ipnrm-active"),o.$sceneListData.find('.ipnrm-scene-list-item[data-scene-id="'+i+'"]').addClass("ipnrm-active"),o.$firstLoad.addClass("ipnrm-hide"),a.prevSceneControl&&o.$prevScene.removeClass("ipnrm-hide"),a.nextSceneControl&&o.$nextScene.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneList.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneListHead.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneListData.removeClass("ipnrm-hide"),a.audioControl&&o.$audioPlayer.removeClass("ipnrm-hide"),a.titleControl&&o.$title.removeClass("ipnrm-hide"),a.fullscreenControl&&o.$fullscreen.removeClass("ipnrm-hide")},R=function(e,n){o.$progress.removeClass("ipnrm-active"),v=!1,L()},z=function(e,n){},H=function(e,n){},q=function(e,n){i.setAudio(n.scene.cfg.audio),n.scene.cfg.title?(o.$title.get(0).innerHTML=n.scene.cfg.title,o.$title.addClass("ipnrm-active")):(o.$title.get(0).innerHTML=null,o.$title.removeClass("ipnrm-active"))},E=function(e,n){},T=function(e,n){if(n)if(d=n.scene.cfg.id,null==p?(f.push(d),p=0):f[p]!=d&&(p+=1,(f=f.slice(0,p)).push(d)),0<p?o.$prevScene.addClass("ipnrm-active"):o.$prevScene.removeClass("ipnrm-active"),p<f.length-1)o.$nextScene.addClass("ipnrm-active");else if(o.$nextScene.removeClass("ipnrm-active"),a.moveToNextScene){for(var i=0;i<n.config.scenes.length;i++){var s=n.config.scenes[i];if(s.id==d)break}i<n.config.scenes.length-1&&o.$nextScene.addClass("ipnrm-active")}},W=function(e,n){$=n.instance},M=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?o.$fullscreen.addClass("ipnrm-active"):o.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){$._onWindowResize()},100)}}};N.Widget=N.Widget||{},N.Widget.List=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);